# OOD Detection and Robustness in Image Classification

## 1. Выбранная задача распознавания

Классификации изображений — распознавание
рукописных цифр от 0 до 9.

- Тип задачи: supervised image classification
- Количество классов: 10
- Формат изображений: 28×28 пикселей, оттенки серого
- Выход модели: распределение вероятностей по классам

Данная задача хорошо подходит для исследования
OOD данных, так как позволяет легко задать
OOD-сдвиг без изменения формата входных данных.

---

## 2. ID и OOD данные

### ID данные
- Датасет: MNIST
- Содержимое: изображения рукописных цифр (0–9)
- Количество
  - train: 60 000
  - test: 10 000

### OOD данные
- Датасет: FashionMNIST
- Содержимое: изображения предметов одежды (футболки, обувь и т.д.)
- Количество: 10 000

### Соотношение доменов
ID и OOD данные имеют:
- одинаковый формат (28×28, grayscale),
- одинаковую размерность,
- разную семантику.

---

## 3. Модель распознавания

Использовалась CNN, реализованная на PyTorch.

Архитектура:
- 2 сверточных слоя (Conv2d + ReLU)
- pooling слой
- 2 полносвязных слоя
- выход: logits размерности 10

Модель обучалась только на ID-данных (MNIST) с функцией потерь
CrossEntropyLoss.

Качество на ID-данных:
- Accuracy на MNIST test: 0.9905

---

## 4. Устойчивость модели к OOD-сдвигу

При подаче OOD-данных:
- модель всегда предсказывает один из ID-классов,
- softmax probability часто остаётся высокой,
- модель не умеет отличать OOD-сэмплы от ID.

Это демонстрирует низкую устойчивость стандартной классификационной модели
к distribution shift.

---

## 5. Детекция OOD данных

Реализованы два метода OOD detection:

### 5.1 MSP, Energy-based

**OOD score:**  

|Method |ROC-AUC| FPR@95TPR|
|---------|-----|-----|
MSP|	0.030183|	0.9999
|	Energy-based|	0.016073|	1.0000

### Интерпретация
- ROC-AUC близок к 0, значит модель практически не различает ID и OOD
- FPR@95TPR ≈ 1, почти все OOD-сэмплы принимаются за ID

Вывод: базовая модель полностью неустойчива к OOD.

---

## 7. Адаптация модели к OOD (Outlier Exposure)

Для повышения устойчивости использован метод Outlier Exposure.

Функция потерь:
- ID loss: CrossEntropy
- OOD loss: KL-divergence к uniform distribution

OOD-данные используются только на этапе адаптации, а не для
основной классификации.

---

## 8. Устойчивость адаптированной модели

После OE:
- уверенность модели на OOD-сэмплах снижается,
- распределения OOD score для ID и OOD лучше разделяются,
- ROC-AUC увеличивается,
- FPR@95TPR снижается.

Таким образом:
- модель стала более устойчива к OOD-сдвигу,
- качество OOD detection улучшилось,
- при этом качество классификации на ID-данных сохраняется.
